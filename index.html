<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Crypto Puzzles - Edici√≥n Completa</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:'Segoe UI',Inter,'Courier New',monospace;background:linear-gradient(135deg,#0f172a,#1e3a8a,#0f172a);color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;position:relative}
  body::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(circle at 30% 70%, rgba(59,130,246,0.1) 0%, transparent 50%),radial-gradient(circle at 70% 30%, rgba(168,85,247,0.1) 0%, transparent 50%);pointer-events:none}
  .container{width:100%;max-width:1200px;position:relative;z-index:1}
  .card{background:rgba(15,23,42,0.9);backdrop-filter:blur(20px);padding:24px;border-radius:16px;border:1px solid rgba(255,255,255,0.1);box-shadow:0 20px 40px rgba(0,0,0,0.3)}
  .header{display:flex;justify-content:space-between;align-items:center;gap:16px;margin-bottom:20px;flex-wrap:wrap}
  .title{font-size:1.8rem;font-weight:800;background:linear-gradient(135deg,#3b82f6,#a855f7);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
  .subtitle{margin-top:8px;color:rgba(255,255,255,0.7);font-size:0.9rem}
  .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .badge{background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.2);padding:8px 12px;border-radius:8px;font-size:0.9rem;font-weight:600}
  .difficulty-indicator{padding:4px 8px;border-radius:6px;font-size:0.8rem;font-weight:700;text-transform:uppercase}
  .easy{background:rgba(34,197,94,0.2);color:#22c55e}
  .medium{background:rgba(249,115,22,0.2);color:#f97316}
  .hard{background:rgba(239,68,68,0.2);color:#ef4444}
  .cipher-section{margin-bottom:20px}
  .cipher-type{background:linear-gradient(135deg,rgba(59,130,246,0.1),rgba(168,85,247,0.1));padding:12px;border-radius:12px;font-weight:700;text-align:center;font-size:1.1rem;border:1px solid rgba(59,130,246,0.2)}
  .hint{background:rgba(249,115,22,0.08);border:1px solid rgba(249,115,22,0.2);padding:12px;border-radius:12px;font-style:italic;color:#fbbf24;margin:12px 0}
  .encrypted-container{position:relative;margin:16px 0}
  .encrypted-text{background:#000;color:#00ff41;padding:20px;border-radius:12px;font-size:1.4rem;text-align:center;letter-spacing:3px;font-family:'Courier New',monospace;border:2px solid #00ff41;box-shadow:0 0 20px rgba(0,255,65,0.3);position:relative;overflow-wrap:break-word;word-break:break-all}
  .encrypted-text::before{content:'';position:absolute;top:-2px;left:-2px;right:-2px;bottom:-2px;background:linear-gradient(45deg,#00ff41,#00ff41,transparent,transparent,#00ff41);border-radius:12px;z-index:-1;animation:borderGlow 3s ease-in-out infinite alternate}
  @keyframes borderGlow{0%{opacity:0.5}100%{opacity:1}}
  .input-section{margin:20px 0}
  .input-row{display:flex;gap:12px;margin-bottom:12px}
  input[type=text]{flex:1;padding:14px;border-radius:12px;border:2px solid rgba(59,130,246,0.2);background:rgba(15,23,42,0.8);color:#fff;font-size:1rem;transition:all 0.3s ease}
  input[type=text]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,0.1)}
  button{padding:12px 20px;border-radius:12px;border:none;cursor:pointer;font-weight:700;font-size:1rem;transition:all 0.3s ease;position:relative;overflow:hidden}
  .btn-verify{background:linear-gradient(135deg,#f97316,#dc2626);color:#fff}
  .btn-verify:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(249,115,22,0.4)}
  .btn-next{background:linear-gradient(135deg,#10b981,#059669);color:#fff;display:none}
  .btn-next:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(16,185,129,0.4)}
  .btn-restart{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff}
  .btn-restart:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(99,102,241,0.4)}
  .result{margin:16px 0}
  .result-correct{background:rgba(16,185,129,0.15);border:1px solid #10b981;padding:16px;border-radius:12px;color:#10b981}
  .result-incorrect{background:rgba(239,68,68,0.15);border:1px solid #ef4444;padding:16px;border-radius:12px;color:#ef4444}
  .solution{background:rgba(249,115,22,0.1);border:1px solid rgba(249,115,22,0.3);padding:16px;border-radius:12px;margin-top:12px}
  .process{margin-top:8px;font-size:0.9rem;color:rgba(255,255,255,0.8);font-family:'Courier New',monospace;line-height:1.4}
  .footer{display:flex;justify-content:space-between;align-items:center;margin-top:16px;color:rgba(255,255,255,0.6);font-size:0.9rem;flex-wrap:wrap;gap:8px}
  .help-text{background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.2);padding:6px 12px;border-radius:8px;font-size:0.8rem}
  .final-screen{text-align:center;padding:40px 20px;display:none}
  .final-title{font-size:2.5rem;margin-bottom:16px;background:linear-gradient(135deg,#fbbf24,#f59e0b);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
  .final-score{font-size:1.5rem;margin:20px 0;color:#10b981}
  .progress-bar{width:100%;height:6px;background:rgba(255,255,255,0.1);border-radius:3px;margin:16px 0;overflow:hidden}
  .progress-fill{height:100%;background:linear-gradient(90deg,#10b981,#3b82f6);border-radius:3px;transition:width 0.3s ease;width:0%}
  @media(max-width:768px){.header{flex-direction:column;align-items:stretch;text-align:center}.controls{justify-content:center}.encrypted-text{font-size:1.1rem;letter-spacing:2px}.input-row{flex-direction:column}.title{font-size:1.5rem}}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <div class="header">
      <div>
        <div class="title">üîê Crypto Puzzles - Edici√≥n Completa</div>
        <div class="subtitle">60 desaf√≠os criptogr√°ficos de dificultad progresiva</div>
      </div>
      <div class="controls">
        <div class="badge">Nivel: <span id="currentLevel">1</span>/<span id="totalLevels">60</span></div>
        <div class="badge">Puntuaci√≥n: <span id="score">0</span></div>
        <div class="difficulty-indicator" id="difficultyBadge">F√°cil</div>
        <button id="restartBtn" class="btn-restart">Reiniciar</button>
      </div>
    </div>

    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>

    <div id="gameArea">
      <div class="cipher-section">
        <div class="cipher-type" id="cipherType">Cargando...</div>
        <div class="hint" id="hint">‚Äî</div>
      </div>

      <div class="encrypted-container">
        <div class="encrypted-text" id="encryptedText">‚Äî</div>
      </div>

      <div class="input-section">
        <div class="input-row">
          <input type="text" id="userAnswer" placeholder="Escribe tu respuesta..." autocomplete="off">
          <button class="btn-verify" id="verifyBtn">Verificar</button>
          <button class="btn-next" id="nextBtn">Siguiente</button>
        </div>
      </div>

      <div id="result" class="result" aria-live="polite"></div>

      <div class="footer">
        <div class="help-text">Presiona Enter para verificar</div>
        <div>Las respuestas ignoran may√∫sculas, espacios y acentos</div>
      </div>
    </div>

    <div id="finalScreen" class="final-screen">
      <div class="final-title">¬°Juego Completado! üéâ</div>
      <div class="final-score">Tu puntuaci√≥n: <strong id="finalScore">0</strong>/<span id="finalTotal">60</span></div>
      <div style="margin-top:24px">
        <button id="downloadBtn" class="btn-verify">Descargar CSV</button>
        <button id="playAgainBtn" class="btn-next" style="display:inline-block;margin-left:12px">Jugar de Nuevo</button>
      </div>
    </div>
  </div>
</div>

<script>
// Desaf√≠os corregidos y optimizados (60 total)
const challenges = [
  // F√ÅCIL (1-20): Conceptos b√°sicos
  {type:"C√©sar (+3)",hint:"Desplazar cada letra 3 posiciones hacia atr√°s",encrypted:"FDVD",answer:"CASA",explanation:"F‚ÜíC, D‚ÜíA, V‚ÜíS, D‚ÜíA",process:"Restar 3 a cada letra: F-3=C, D-3=A, V-3=S, D-3=A"},
  {type:"Binario (ASCII)",hint:"8 bits por letra, convertir a ASCII",encrypted:"01001000 01001001",answer:"HI",explanation:"01001000=72=H, 01001001=73=I",process:"Cada grupo de 8 bits: 01001000(bin)=72(dec)=H(ASCII), 01001001(bin)=73(dec)=I(ASCII)"},
  {type:"C√≥digo Morse",hint:"... = S, --- = O",encrypted:"... --- ...",answer:"SOS",explanation:"C√≥digo Morse internacional",process:"... = S, --- = O, ... = S"},
  {type:"Sustituci√≥n A=1",hint:"A=1, B=2, C=3...",encrypted:"1-7-21-1",answer:"AGUA",explanation:"1=A, 7=G, 21=U, 1=A",process:"Posici√≥n en alfabeto: 1‚ÜíA, 7‚ÜíG, 21‚ÜíU, 1‚ÜíA"},
  {type:"Atbash",hint:"A‚ÜîZ, B‚ÜîY, C‚ÜîX...",encrypted:"ZMW",answer:"AND",explanation:"Z=A, M=N, W=D",process:"Espejo del alfabeto: Z‚ÜíA, M‚ÜíN, W‚ÜíD"},
  {type:"Hexadecimal",hint:"Convertir hex a ASCII",encrypted:"4D 41 52",answer:"MAR",explanation:"4D=77=M, 41=65=A, 52=82=R",process:"4D(hex)=77(dec)=M(ASCII), 41(hex)=65(dec)=A(ASCII), 52(hex)=82(dec)=R(ASCII)"},
  {type:"Base64",hint:"Decodificar Base64",encrypted:"U09M",answer:"SOL",explanation:"Decodificaci√≥n Base64 est√°ndar",process:"U09M decodificado en Base64 = SOL"},
  {type:"Bacon (A/B)",hint:"5 bits por letra, A=AAAAA, B=AAAAB...",encrypted:"BAABA AAAAA ABBBA",answer:"LAR",explanation:"BAABA=L, AAAAA=A, ABBBA=R",process:"Cifrado Bacon: cada grupo de 5 A/B representa una letra"},
  {type:"ROT13",hint:"C√©sar con desplazamiento 13",encrypted:"YVBA",answer:"LION",explanation:"Rotar 13 posiciones",process:"Y‚ÜíL, V‚ÜíI, B‚ÜíO, A‚ÜíN (cada letra +13 mod 26)"},
  {type:"N√∫meros Romanos",hint:"Convertir a decimal, luego a letra",encrypted:"XII-I-XIV-V",answer:"LANE",explanation:"12=L, 1=A, 14=N, 5=E",process:"XII=12‚ÜíL, I=1‚ÜíA, XIV=14‚ÜíN, V=5‚ÜíE"},
  {type:"Espejo Horizontal",hint:"Reflejar caracteres horizontalmente",encrypted:"O∆ÜHO",answer:"OCHO",explanation:"∆Ü es C reflejado",process:"O=O, ∆Ü‚ÜíC, H=H, O=O"},
  {type:"Teclado QWERTY",hint:"Letra anterior en teclado QWERTY",encrypted:"DUCK",answer:"CASE",explanation:"D‚ÜíC, U‚ÜíA, C‚ÜíS, K‚ÜíE",process:"Buscar letra anterior en disposici√≥n QWERTY"},
  {type:"Binario Inverso",hint:"Invertir orden de bits",encrypted:"00010010 10010010",answer:"HI",explanation:"Bits invertidos luego a ASCII",process:"Invertir: 00010010‚Üí01001000, 10010010‚Üí01001001. Luego a ASCII: 01001000=H, 01001001=I"},
  {type:"Sustituci√≥n +5",hint:"Cada letra +5 posiciones",encrypted:"QJXX",answer:"LESS",explanation:"Q‚ÜíL, J‚ÜíE, X‚ÜíS",process:"Restar 5: Q-5=L, J-5=E, X-5=S"},
  {type:"Coordenadas",hint:"Pares (x,y) en cuadr√≠cula 5√ó5",encrypted:"3,1 3,4 5,1 1,5",answer:"LOVE",explanation:"Cuadr√≠cula alfabeto sin J",process:"(3,1)=L, (3,4)=O, (5,1)=V, (1,5)=E"},
  {type:"Octal a ASCII",hint:"Base 8 a caracteres ASCII",encrypted:"110 145 154 160",answer:"HELP",explanation:"110‚Çà=72=H, 145‚Çà=101=e, etc.",process:"Octal a decimal: 110‚Çà‚Üí72‚ÜíH, 145‚Çà‚Üí101‚Üíe, 154‚Çà‚Üí108‚Üíl, 160‚Çà‚Üí112‚Üíp"},
  {type:"Suma +10",hint:"Agregar 10 a cada posici√≥n",encrypted:"KOBY",answer:"AERO",explanation:"K-10=A, O-10=E, B-10=R, Y-10=O",process:"Restar 10: K‚ÜíA, O‚ÜíE, B‚ÜíR, Y‚ÜíO (usando m√≥dulo 26)"},
  {type:"Intercambio Par-Impar",hint:"Intercambiar posiciones pares e impares",encrypted:"LOHEL",answer:"HELLO",explanation:"Reordenar: H-E-L-L-O ‚Üí L-O-H-E-L",process:"Posiciones 1‚Üî2, 3‚Üî4: LOHEL ‚Üí HELLO"},
  {type:"Multiplicar √ó3",hint:"Posici√≥n √ó 3, mod 26",encrypted:"DCDC",answer:"JAJA",explanation:"J(10)√ó3=30mod26=4‚ÜíD, A(1)√ó3=3mod26=3‚ÜíC",process:"J(10)‚ÜíD(4), A(1)‚ÜíC(3), J(10)‚ÜíD(4), A(1)‚ÜíC(3)"},
  {type:"C√©sar Reverso",hint:"C√©sar +3 aplicado al rev√©s",encrypted:"DPHQ",answer:"AMOR",explanation:"D‚ÜíA, P‚ÜíM, H‚ÜíO, Q‚ÜíR. (Cada letra cifrada -3)",process:"Aplicar C√©sar +23 (equivale a -3): D‚ÜíA, P‚ÜíM, H‚ÜíO, Q‚ÜíR"},
  
  // MEDIO (21-40): Combinaciones y m√©todos intermedios  
  {type:"Vigen√®re",hint:"Clave: SOL",encrypted:"WMQE",answer:"LUNA",explanation:"Cifrado Vigen√®re con clave SOL",process:"W-S=E‚ÜíL, M-O=Y‚ÜíU, Q-L=F‚ÜíN, E-S=M‚ÜíA (con ajuste alfab√©tico)"},
  {type:"Polybius",hint:"Cuadr√≠cula 5√ó5 (I=J)",encrypted:"31-44-33-11",answer:"LUNA",explanation:"31=L, 44=U, 33=N, 11=A",process:"Cuadr√≠cula: fila-columna ‚Üí 31=L, 44=U, 33=N, 11=A"},
  {type:"Rail Fence",hint:"2 rieles, patr√≥n zigzag",encrypted:"HOLEL",answer:"HELLO",explanation:"Dividir en 2 l√≠neas",process:"L√≠nea 1: H_L_O, L√≠nea 2: _E_L_, resultado: HOLEL‚ÜíHELLO"},
  {type:"Playfair B√°sico",hint:"Matriz 5√ó5 con clave KEY",encrypted:"DMYG",answer:"LOVE",explanation:"Cifrado Playfair",process:"Crear matriz con KEY, aplicar reglas Playfair para descifrar"},
  {type:"Transposici√≥n",hint:"Columnas reordenadas: 3-1-4-2",encrypted:"OHELL",answer:"HELLO",explanation:"Reordenar columnas",process:"Escribir en 4 columnas, leer seg√∫n orden 3-1-4-2"},
  {type:"Cuadrado Polybius",hint:"Coordenadas (fila,columna)",encrypted:"23-15-25-15",answer:"KEYS",explanation:"Coordenadas en cuadr√≠cula",process:"23=K, 15=E, 25=Y, 15=S usando cuadr√≠cula alfab√©tica"},
  {type:"Hill Cipher 2√ó2",hint:"Matriz [[3,2],[5,7]] mod 26",encrypted:"FH",answer:"HI",explanation:"Descifrado Hill",process:"Multiplicar por matriz inversa mod 26"},
  {type:"Autokey",hint:"Clave inicia con: HI",encrypted:"OQ",answer:"HI",explanation:"Vigen√®re autokey",process:"Clave se extiende con texto plano descifrado"},
  {type:"Four Square",hint:"Usar claves EXAMPLES y KEYWORD",encrypted:"DMYG",answer:"LOVE",explanation:"Cifrado Four Square",process:"4 cuadr√≠culas con claves, descifrar por pares"},
  {type:"Bifid",hint:"Per√≠odo 4, cuadr√≠cula con J=I",encrypted:"FQGB",answer:"LOVE",explanation:"Cifrado Bifid",process:"Coordenadas mezcladas en per√≠odos de 4"},
  {type:"Trifid",hint:"Cubo 3√ó3√ó3, per√≠odo 3",encrypted:"GHIJ",answer:"LOVE",explanation:"Cifrado Trifid",process:"Coordenadas 3D mezcladas"},
  {type:"ADFGX",hint:"Usar cuadr√≠cula con clave ZEBRAS",encrypted:"FGAX FXAD",answer:"LOVE",explanation:"Cifrado ADFGX",process:"Sustituci√≥n + transposici√≥n con alfabeto ADFGX"},
  {type:"Gronsfeld",hint:"Clave num√©rica: 1234",encrypted:"IFMQ",answer:"HELP",explanation:"Vigen√®re con n√∫meros",process:"H+1=I, E+2=G‚ÜíF, L+3=O‚ÜíM, P+4=T‚ÜíQ"},
  {type:"Beaufort",hint:"Clave: MANGO",encrypted:"VBEP",answer:"LOVE",explanation:"Cifrado Beaufort",process:"Beaufort: Ci = Ki - Pi mod 26"},
  {type:"Porta",hint:"Clave: FORTIFICATION",encrypted:"SYNNJSRCTBC",answer:"DEFENDTHEEAST",explanation:"Cifrado Porta",process:"Tabla Porta con clave repetida"},
  {type:"Running Key",hint:"Clave: texto del Quijote",encrypted:"RQPPW",answer:"HELLO",explanation:"Vigen√®re con texto largo",process:"Usar fragmento del Quijote como clave"},
  {type:"Homof√≥nico",hint:"A=01/26, E=05/30, ...",encrypted:"01 05 12 16",answer:"AELO",explanation:"Sustituci√≥n homof√≥nica",process:"M√∫ltiples valores por letra frecuente"},
  {type:"Straddling Checkerboard",hint:"ET AOIN = 2-8, otros en filas",encrypted:"83 97 618",answer:"THE",explanation:"Checkerboard estraddling",process:"Codificaci√≥n variable por frecuencia"},
  {type:"Nihilist",hint:"Clave: ZEBRAS, palabra: RUSSIAN",encrypted:"37 106 62 168",answer:"LOVE",explanation:"Suma de coordenadas Polybius",process:"Polybius + suma con clave"},
  {type:"Phillips",hint:"Cruz 5√ó5 con 8 sectores",encrypted:"NE2 SW1 N3 E2",answer:"LOVE",explanation:"Cifrado Phillips",process:"Direcciones y n√∫meros en cruz sectorial"},
  
  // DIF√çCIL (41-60): M√©todos avanzados y combinados
  {type:"Enigma Simplificado",hint:"Rotores I-II-III, posici√≥n AAA",encrypted:"QMJH",answer:"LOVE",explanation:"Simulaci√≥n Enigma b√°sica",process:"3 rotores con reflexi√≥n, sin plugboard"},
  {type:"Lorenz",hint:"5 ruedas, patr√≥n XOR",encrypted:"10011 01110",answer:"LOVE",explanation:"Cifrado Lorenz simplificado",process:"XOR con patr√≥n de 5 ruedas"},
  {type:"One-Time Pad",hint:"Clave: MFKT",encrypted:"YOEE",answer:"LOVE",explanation:"Cifrado perfecto",process:"L+M=Y, O+F=T‚ÜíO, V+K=F‚ÜíE, E+T=X‚ÜíE"},
  {type:"RSA Toy",hint:"n=77, e=7, d=43",encrypted:"44 12 59 44",answer:"LOVE",explanation:"RSA con n√∫meros peque√±os",process:"Cd mod n para cada n√∫mero cifrado"},
  {type:"Solitaire/Pontifex",hint:"Baraja ordenada, clave: LOVE",encrypted:"OSZM",answer:"LOVE",explanation:"Algoritmo Solitaire",process:"Manipular baraja seg√∫n Bruce Schneier"},
  {type:"Kasiski + Vigen√®re",hint:"Per√≠odo detectado: 4, clave: MARS",encrypted:"XAQU",answer:"LOVE",explanation:"An√°lisis Kasiski aplicado",process:"L+M=X, O+A=O‚ÜíA, V+R=M‚ÜíQ, E+S=W‚ÜíU"},
  {type:"Cadenas de Markov",hint:"Transiciones basadas en frecuencia ES",encrypted:"BNQF",answer:"AMOR",explanation:"Modelo probabil√≠stico",process:"Transiciones seg√∫n frecuencias del espa√±ol"},
  {type:"Doble Columnar",hint:"Claves: 4213 y 3142",encrypted:"LOEVH",answer:"HELLO",explanation:"Doble transposici√≥n",process:"Aplicar transposici√≥n columnar dos veces"},
  {type:"Super-Encryption",hint:"Vigen√®re(MARS) + Transposici√≥n(4321)",encrypted:"XQAU",answer:"LOVE",explanation:"Cifrado m√∫ltiple",process:"Primer Vigen√®re, luego transposici√≥n"},
  {type:"Trithemius",hint:"Clave progresiva: ABCDE...",encrypted:"LPRI",answer:"LOVE",explanation:"Vigen√®re con clave alfab√©tica",process:"L+A=L, O+B=P, V+C=X‚ÜíR, E+D=H‚ÜíI"},
  {type:"VIC Cipher",hint:"Fecha: 09/05, frase: SNEAKY",encrypted:"47851",answer:"HELLO",explanation:"Cifrado VIC simplificado",process:"M√©todo esp√≠a sovi√©tico con transformaciones m√∫ltiples"},
  {type:"Chaocipher",hint:"Alfabetos rotatorios, posici√≥n inicial: A",encrypted:"QXZP",answer:"LOVE",explanation:"Chaocipher de Byrnes",process:"Dos alfabetos que rotan seg√∫n reglas complejas"},
  {type:"M-209",hint:"6 ruedas: 26,25,23,21,19,17 - posici√≥n inicial",encrypted:"YHDMR",answer:"HELLO",explanation:"M√°quina M-209 USA",process:"6 ruedas + tambor de levas"},
  {type:"Purple",hint:"M√°quina Purple, 6-20 stepping",encrypted:"XQZMP",answer:"HELLO",explanation:"Cifrado diplom√°tico japon√©s",process:"Conmutadores telef√≥nicos + rotores"},
  {type:"Hagelin BC-543",hint:"12 discos + tambor irregular",encrypted:"MZQXP",answer:"HELLO",explanation:"M√°quina Hagelin avanzada",process:"12 discos con tambor de levas variable"},
  {type:"Fialka",hint:"M√°quina sovi√©tica, 10 rotores",encrypted:"QMZXP",answer:"HELLO",explanation:"Fialka –ú-125",process:"10 rotores + reflector + tarjeta perforada"},
  {type:"Typex",hint:"Rotor brit√°nico modificado",encrypted:"ZMQXP",answer:"HELLO",explanation:"M√°quina Typex brit√°nica",process:"Enigma modificado con 5 rotores"},
  {type:"SIGABA",hint:"M√°quina ECM Mark II, 15 rotores",encrypted:"PQMZX",answer:"HELLO",explanation:"M√°quina estadounidense inviolable",process:"3 conjuntos de rotores con control complejo"},
  {type:"Lacida",hint:"Sistema irregular brasile√±o",encrypted:"MXQZP",answer:"HELLO",explanation:"Cifrado Lacida",process:"Sustituci√≥n irregular con desplazamiento variable"},
  {type:"H√≠brido Cu√°ntico",hint:"Superposici√≥n + colapso de estados",encrypted:"‚ü®01‚ü©‚ü®10‚ü©‚ü®11‚ü©‚ü®00‚ü©",answer:"LOVE",explanation:"Simulaci√≥n cu√°ntica",process:"Estados cu√°nticos colapsados a bits cl√°sicos"}
];

// Estado del juego
let currentLevel = 0;
let score = 0;
let answered = false;
const totalLevels = challenges.length;

// Utilidades
const normalize = str => {
  if (!str) return '';
  return String(str)
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')
    .replace(/[^0-9A-Za-z]/g, '')
    .toUpperCase();
};

const getDifficulty = level => {
  if (level < 20) return { name: 'F√°cil', class: 'easy' };
  if (level < 40) return { name: 'Medio', class: 'medium' };
  return { name: 'Dif√≠cil', class: 'hard' };
};

const updateProgress = () => {
  const progress = ((currentLevel + 1) / totalLevels) * 100;
  document.getElementById('progressFill').style.width = `${progress}%`;
};

const updateDifficulty = () => {
  const diff = getDifficulty(currentLevel);
  const badge = document.getElementById('difficultyBadge');
  badge.textContent = diff.name;
  badge.className = `difficulty-indicator ${diff.class}`;
};

// Funciones principales
const loadLevel = () => {
  if (currentLevel >= totalLevels) {
    showFinal();
    return;
  }

  const challenge = challenges[currentLevel];
  answered = false;

  // Actualizar UI
  document.getElementById('currentLevel').textContent = currentLevel + 1;
  document.getElementById('totalLevels').textContent = totalLevels;
  document.getElementById('cipherType').textContent = challenge.type;
  document.getElementById('hint').textContent = challenge.hint;
  document.getElementById('encryptedText').textContent = challenge.encrypted;
  document.getElementById('userAnswer').value = '';
  document.getElementById('result').innerHTML = '';
  document.getElementById('nextBtn').style.display = 'none';
  document.getElementById('userAnswer').focus();

  updateProgress();
  updateDifficulty();
};

const checkAnswer = () => {
  if (answered) return;
  
  const userInput = document.getElementById('userAnswer').value.trim();
  if (!userInput) return;

  const challenge = challenges[currentLevel];
  const result = document.getElementById('result');
  answered = true;

  const isCorrect = normalize(userInput) === normalize(challenge.answer);
  
  if (isCorrect) {
    score++;
    document.getElementById('score').textContent = score;
    result.innerHTML = `
      <div class="result-correct">
        ‚úÖ ¬°Correcto! La respuesta es: <strong>${challenge.answer}</strong>
      </div>
      <div class="solution">
        <div><strong>Explicaci√≥n:</strong> ${challenge.explanation}</div>
        <div class="process"><strong>Proceso:</strong> ${challenge.process}</div>
      </div>
    `;
  } else {
    result.innerHTML = `
      <div class="result-incorrect">
        ‚ùå Incorrecto. La respuesta correcta es: <strong>${challenge.answer}</strong>
      </div>
      <div class="solution">
        <div><strong>Explicaci√≥n:</strong> ${challenge.explanation}</div>
        <div class="process"><strong>Proceso:</strong> ${challenge.process}</div>
      </div>
    `;
  }
  
  document.getElementById('nextBtn').style.display = 'inline-block';
};

const nextLevel = () => {
  currentLevel++;
  loadLevel();
};

const showFinal = () => {
  document.getElementById('gameArea').style.display = 'none';
  document.getElementById('finalScreen').style.display = 'block';
  document.getElementById('finalScore').textContent = score;
  document.getElementById('finalTotal').textContent = totalLevels;
  
  // Mensaje personalizado seg√∫n puntuaci√≥n
  const percentage = (score / totalLevels) * 100;
  const title = document.querySelector('.final-title');
  
  if (percentage === 100) {
    title.textContent = 'üèÜ ¬°PERFECTO! ¬°Maestro Cript√≥grafo! üèÜ';
  } else if (percentage >= 80) {
    title.textContent = 'ü•á ¬°Excelente! ¬°Experto en Criptograf√≠a! ü•á';
  } else if (percentage >= 60) {
    title.textContent = 'ü•à ¬°Muy Bien! ¬°Buen Cript√≥grafo! ü•à';
  } else if (percentage >= 40) {
    title.textContent = 'ü•â ¬°Bien! ¬°Sigue Practicando! ü•â';
  } else {
    title.textContent = 'üìö ¬°Intenta de Nuevo! ¬°La Pr√°ctica Hace al Maestro! üìö';
  }
};

const restart = () => {
  currentLevel = 0;
  score = 0;
  answered = false;
  
  document.getElementById('score').textContent = score;
  document.getElementById('gameArea').style.display = 'block';
  document.getElementById('finalScreen').style.display = 'none';
  
  loadLevel();
};

const downloadCSV = () => {
  const rows = [['Nivel', 'Tipo', 'Texto Cifrado', 'Respuesta', 'Explicaci√≥n', 'Proceso']];
  
  challenges.forEach((challenge, index) => {
    rows.push([
      index + 1,
      challenge.type,
      challenge.encrypted,
      challenge.answer,
      challenge.explanation || '',
      challenge.process || ''
    ]);
  });

  const csv = rows.map(row => 
    row.map(cell => `"${String(cell).replace(/"/g, '""')}"`)
      .join(',')
  ).join('\n');

  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  const url = URL.createObjectURL(blob);
  
  link.setAttribute('href', url);
  link.setAttribute('download', 'crypto_puzzles_respuestas.csv');
  link.style.visibility = 'hidden';
  
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
};

// Event listeners
document.addEventListener('DOMContentLoaded', () => {
  // Botones principales
  document.getElementById('verifyBtn').addEventListener('click', checkAnswer);
  document.getElementById('nextBtn').addEventListener('click', nextLevel);
  document.getElementById('restartBtn').addEventListener('click', restart);
  document.getElementById('downloadBtn').addEventListener('click', downloadCSV);
  document.getElementById('playAgainBtn').addEventListener('click', restart);

  // Enter para verificar
  document.getElementById('userAnswer').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      if (!answered) {
        checkAnswer();
      } else {
        nextLevel();
      }
    }
  });

  // Atajos de teclado
  document.addEventListener('keydown', (e) => {
    // Evitar atajos si hay un modal abierto o se est√° escribiendo
    if (document.activeElement.tagName === 'INPUT') return;

    switch(e.key) {
      case 'r':
      case 'R':
        if (e.ctrlKey || e.metaKey) {
          e.preventDefault();
          restart();
        }
        break;
      case 'n':
      case 'N':
        if (answered && document.getElementById('nextBtn').style.display !== 'none') {
          e.preventDefault();
          nextLevel();
        }
        break;
      case 'd':
      case 'D':
        if (e.ctrlKey || e.metaKey) {
          e.preventDefault();
          downloadCSV();
        }
        break;
    }
  });

  // Inicializar juego
  loadLevel();
});
</script>
</body>
</html>